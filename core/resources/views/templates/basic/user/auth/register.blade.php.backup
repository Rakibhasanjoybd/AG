@php
    $policyPages = getContent('policy_pages.element', false, null, true);
    $registerCaption = getContent('register.content', true);
@endphp
<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="theme-color" content="#52006A">
    <title>{{ $general->siteName(__($pageTitle ?? 'রেজিস্টার')) }}</title>
    @include('partials.seo')
    <link href="{{ asset('assets/global/css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ asset('assets/global/css/all.min.css') }}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { height: 100%; }
        body {
            font-family: 'Noto Sans Bengali', sans-serif;
            background: linear-gradient(135deg, #52006A 0%, #3d0050 50%, #2a0038 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .register-container {
            width: 100%;
            max-width: 480px;
            background: #fff;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            max-height: 95vh;
            display: flex;
            flex-direction: column;
        }
        
        .register-header {
            background: linear-gradient(135deg, #FF7600 0%, #e66a00 100%);
            padding: 24px;
            text-align: center;
            flex-shrink: 0;
        }
        .header-top {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .logo-wrap {
            width: 55px;
            height: 55px;
            background: #fff;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .logo-wrap img {
            width: 35px;
            height: auto;
        }
        .header-text h1 {
            color: #fff;
            font-size: 20px;
            font-weight: 700;
            text-align: left;
        }
        .header-text p {
            color: rgba(255,255,255,0.9);
            font-size: 12px;
            text-align: left;
        }
        
        .register-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
        }
        .form-row.full {
            grid-template-columns: 1fr;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
        }
        .form-group label .required {
            color: #CD113B;
        }
        .input-wrap {
            position: relative;
        }
        .input-wrap i {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: #FF7600;
            font-size: 14px;
        }
        .input-wrap input,
        .input-wrap select {
            width: 100%;
            padding: 12px 14px 12px 42px;
            border: 2px solid #e8e8e8;
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
            background: #fff;
        }
        .input-wrap input:focus,
        .input-wrap select:focus {
            outline: none;
            border-color: #FF7600;
            box-shadow: 0 0 0 3px rgba(255,118,0,0.1);
        }
        .input-wrap.no-icon input,
        .input-wrap.no-icon select {
            padding-left: 14px;
        }
        
        .mobile-input {
            display: flex;
            gap: 0;
        }
        .mobile-code-box {
            background: #f5f5f5;
            border: 2px solid #e8e8e8;
            border-right: none;
            border-radius: 10px 0 0 10px;
            padding: 12px 14px;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            min-width: 70px;
            text-align: center;
        }
        .mobile-input input {
            border-radius: 0 10px 10px 0;
            padding-left: 14px;
        }
        
        .error-text {
            font-size: 11px;
            color: #CD113B;
            margin-top: 4px;
        }
        
        .password-hints {
            background: #fff8f0;
            border: 1px solid #ffe0c0;
            border-radius: 8px;
            padding: 10px 12px;
            margin-top: 8px;
            display: none;
        }
        .password-hints.show { display: block; }
        .password-hints p {
            font-size: 11px;
            color: #CD113B;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .password-hints p::before {
            content: '×';
            font-weight: bold;
        }
        .password-hints p.success {
            color: #10b981;
        }
        .password-hints p.success::before {
            content: '✓';
        }
        
        .agree-wrap {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 20px;
        }
        .agree-wrap input {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            accent-color: #FF7600;
        }
        .agree-wrap label {
            font-size: 12px;
            color: #555;
            line-height: 1.5;
        }
        .agree-wrap a {
            color: #FF7600;
            font-weight: 600;
        }
        
        .btn-register {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #FF7600 0%, #e66a00 100%);
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(255,118,0,0.35);
        }
        .btn-register:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(255,118,0,0.45);
        }
        
        .divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
        }
        .divider::before, .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #e0e0e0;
        }
        .divider span {
            padding: 0 15px;
            color: #999;
            font-size: 12px;
        }
        
        .login-link {
            text-align: center;
            font-size: 13px;
            color: #666;
        }
        .login-link a {
            color: #52006A;
            font-weight: 700;
            text-decoration: none;
        }
        
        .back-home {
            display: block;
            text-align: center;
            color: #999;
            font-size: 12px;
            text-decoration: none;
            margin-top: 16px;
            padding-bottom: 5px;
        }
        .back-home:hover { color: #52006A; }
        
        .referral-box {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 1px solid #bbf7d0;
            border-radius: 10px;
            padding: 12px 14px;
            margin-bottom: 16px;
        }
        .referral-box label {
            color: #166534;
        }
        .referral-box input {
            background: #fff;
            border-color: #86efac;
        }
        
        @media (max-width: 480px) {
            .form-row { grid-template-columns: 1fr; }
            .register-body { padding: 20px 16px; }
        }
    </style>
</head>
<body>
    <div class="register-container">
        <div class="register-header">
            <div class="header-top">
                <div class="logo-wrap">
                    <img src="{{ getImage(getFilePath('logoIcon') .'/logo.png') }}" alt="{{ $general->site_name ?? 'AGCO' }}">
                </div>
                <div class="header-text">
                    <h1>{{ __(@$registerCaption->data_values->heading ?? 'নতুন অ্যাকাউন্ট') }}</h1>
                    <p>আজই যোগ দিন এবং আয় করুন</p>
                </div>
            </div>
        </div>
        
        <div class="register-body">
            <form class="verify-gcaptcha" action="{{ route('user.register') }}" method="post">
                @csrf
                
                @if (session()->get('reference') != null)
                <div class="referral-box">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label><i class="fas fa-gift"></i> @lang('রেফারেল কোড')</label>
                        <div class="input-wrap no-icon">
                            <input type="text" name="referBy" value="{{ session()->get('reference') }}" readonly>
                        </div>
                    </div>
                </div>
                @endif
                
                <div class="form-row">
                    <div class="form-group">
                        <label>@lang('ইউজারনেম') <span class="required">*</span></label>
                        <div class="input-wrap">
                            <i class="fas fa-user"></i>
                            <input type="text" name="username" class="checkUser" placeholder="@lang('ইউজারনেম')" value="{{ old('username') }}" required>
                        </div>
                        <small class="error-text usernameExist"></small>
                    </div>
                    
                    <div class="form-group">
                        <label>@lang('পুরো নাম') <span class="required">*</span></label>
                        <div class="input-wrap">
                            <i class="fas fa-id-card"></i>
                            <input type="text" name="fullname" placeholder="@lang('আপনার নাম')" value="{{ old('fullname') }}" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-row full">
                    <div class="form-group">
                        <label>@lang('ইমেইল') <span class="required">*</span></label>
                        <div class="input-wrap">
                            <i class="fas fa-envelope"></i>
                            <input type="email" name="email" class="checkUser" placeholder="@lang('example@email.com')" value="{{ old('email') }}" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>@lang('দেশ') <span class="required">*</span></label>
                        <div class="input-wrap">
                            <i class="fas fa-globe"></i>
                            <select name="country" required>
                                @foreach ($countries as $key => $country)
                                    <option data-mobile_code="{{ $country->dial_code }}" value="{{ $country->country }}" data-code="{{ $key }}">{{ __($country->country) }}</option>
                                @endforeach
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>@lang('মোবাইল নম্বর') <span class="required">*</span></label>
                        <div class="mobile-input">
                            <span class="mobile-code-box mobile-code"></span>
                            <input type="hidden" name="mobile_code">
                            <input type="hidden" name="country_code">
                            <input type="number" name="mobile" class="checkUser" placeholder="@lang('01XXXXXXXXX')" value="{{ old('mobile') }}" required>
                        </div>
                        <small class="error-text mobileExist"></small>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>@lang('পাসওয়ার্ড') <span class="required">*</span></label>
                        <div class="input-wrap">
                            <i class="fas fa-lock"></i>
                            <input type="password" name="password" placeholder="@lang('পাসওয়ার্ড')" required>
                        </div>
                        @if ($general->secure_password)
                        <div class="password-hints" id="passHints">
                            <p class="lower">@lang('১টি ছোট অক্ষর')</p>
                            <p class="capital">@lang('১টি বড় অক্ষর')</p>
                            <p class="number">@lang('১টি সংখ্যা')</p>
                            <p class="special">@lang('১টি বিশেষ চিহ্ন')</p>
                            <p class="minimum">@lang('কমপক্ষে ৬ অক্ষর')</p>
                        </div>
                        @endif
                    </div>
                    
                    <div class="form-group">
                        <label>@lang('পাসওয়ার্ড নিশ্চিত') <span class="required">*</span></label>
                        <div class="input-wrap">
                            <i class="fas fa-lock"></i>
                            <input type="password" name="password_confirmation" placeholder="@lang('পুনরায় পাসওয়ার্ড')" required>
                        </div>
                    </div>
                </div>
                
                <x-captcha></x-captcha>
                
                @if ($general->agree)
                <div class="agree-wrap">
                    <input type="checkbox" id="agree" name="agree" @checked(old('agree')) required>
                    <label for="agree">
                        @lang('আমি সম্মত') 
                        @foreach ($policyPages as $policy)
                            <a href="{{ route('policy.pages', [slug($policy->data_values->title), $policy->id]) }}" target="_blank">{{ __($policy->data_values->title) }}</a>@if (!$loop->last), @endif
                        @endforeach
                    </label>
                </div>
                @endif
                
                <button type="submit" class="btn-register">
                    <i class="fas fa-user-plus"></i>
                    @lang('রেজিস্টার করুন')
                </button>
            </form>
            
            <div class="divider"><span>অথবা</span></div>
            
            <p class="login-link">
                @lang('ইতিমধ্যে অ্যাকাউন্ট আছে?') <a href="{{ route('user.login') }}">@lang('লগইন করুন')</a>
            </p>
            
            <a href="{{ route('home') }}" class="back-home">
                <i class="fas fa-arrow-left"></i> @lang('হোম পেজে ফিরুন')
            </a>
        </div>
    </div>

    <!-- Existing User Modal -->
    <div class="modal fade" id="existModalCenter" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content" style="border-radius: 16px;">
                <div class="modal-header" style="background: #FF7600; color: #fff; border-radius: 16px 16px 0 0;">
                    <h5 class="modal-title">@lang('আপনি আমাদের সাথে আছেন')</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center py-4">
                    <i class="fas fa-user-check fa-3x text-success mb-3"></i>
                    <h6>@lang('আপনার ইতিমধ্যে অ্যাকাউন্ট আছে, অনুগ্রহ করে লগইন করুন')</h6>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">@lang('বন্ধ')</button>
                    <a href="{{ route('user.login') }}" class="btn" style="background: #FF7600; color: #fff;">@lang('লগইন')</a>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ asset('assets/global/js/jquery-3.6.0.min.js') }}"></script>
    <script src="{{ asset('assets/global/js/bootstrap.bundle.min.js') }}"></script>
    @include('partials.notify')
    
    @if ($general->secure_password)
    <script src="{{ asset('assets/global/js/secure_password.js') }}"></script>
    @endif
    
    <script>
        "use strict";
        (function($) {
            @if ($mobileCode)
                $(`option[data-code={{ $mobileCode }}]`).attr('selected', '');
            @endif

            $('select[name=country]').change(function() {
                $('input[name=mobile_code]').val($('select[name=country] :selected').data('mobile_code'));
                $('input[name=country_code]').val($('select[name=country] :selected').data('code'));
                $('.mobile-code').text('+' + $('select[name=country] :selected').data('mobile_code'));
            }).change();

            @if ($general->secure_password)
                $('input[name=password]').on('focus', function() {
                    $('#passHints').addClass('show');
                }).on('blur', function() {
                    $('#passHints').removeClass('show');
                }).on('input', function() {
                    var password = $(this).val();
                    $('.password-hints p').removeClass('success');
                    if(/[a-z]/.test(password)) $('.lower').addClass('success');
                    if(/[A-Z]/.test(password)) $('.capital').addClass('success');
                    if(/[0-9]/.test(password)) $('.number').addClass('success');
                    if(/[^a-zA-Z0-9]/.test(password)) $('.special').addClass('success');
                    if(password.length >= 6) $('.minimum').addClass('success');
                });
            @endif

            $('.checkUser').on('focusout', function(e) {
                var url = '{{ route('user.checkUser') }}';
                var value = $(this).val();
                var token = '{{ csrf_token() }}';
                var data = {};
                
                if ($(this).attr('name') == 'mobile') {
                    var mobile = `${$('.mobile-code').text().substr(1)}${value}`;
                    data = { mobile: mobile, _token: token };
                } else if ($(this).attr('name') == 'email') {
                    data = { email: value, _token: token };
                } else if ($(this).attr('name') == 'username') {
                    data = { username: value, _token: token };
                }
                
                $.post(url, data, function(response) {
                    if (response.data != false && response.type == 'email') {
                        $('#existModalCenter').modal('show');
                    } else if (response.data != false) {
                        $(`.${response.type}Exist`).text(`এই ${response.type} ইতিমধ্যে ব্যবহৃত`);
                    } else {
                        $(`.${response.type}Exist`).text('');
                    }
                });
            });
        })(jQuery);
    </script>
</body>
</html>
